#include <stdio.h>
#include <math.h>
// int NAR_inference(double* b1, double** w1, double* b2, double*);

typedef struct settings
{
    int offset;
    int gain;
    int ymin;
};

int main(int argc, char const *argv[])
{

    double x[293] = {10.6000000000000,10.4000000000000,10.2000000000000,10.2000000000000,10,9.90000000000000,10,10.3000000000000,10.7000000000000,11.1000000000000,11.5000000000000,11.9000000000000,12,12.2000000000000,12.2000000000000,12.1000000000000,12,11.9000000000000,11.7000000000000,11.5000000000000,11.4000000000000,11.2000000000000,11,10.9000000000000,10.8000000000000,10.6000000000000,10.4000000000000,10.2000000000000,10,9.80000000000000,9.70000000000000,9.60000000000000,9.50000000000000,9.50000000000000,9.60000000000000,9.80000000000000,9.90000000000000,10,10.2000000000000,10.2000000000000,10.2000000000000,10,9.90000000000000,9.70000000000000,9.50000000000000,9.30000000000000,9.10000000000000,8.80000000000000,8.60000000000000,8.40000000000000,8.20000000000000,8,7.90000000000000,7.80000000000000,7.80000000000000,7.90000000000000,7.90000000000000,7.90000000000000,7.90000000000000,7.80000000000000,7.70000000000000,7.50000000000000,7.40000000000000,7.30000000000000,7.10000000000000,7,6.90000000000000,6.90000000000000,6.80000000000000,6.80000000000000,6.70000000000000,6.60000000000000,6.50000000000000,6.40000000000000,6.30000000000000,6.20000000000000,6.10000000000000,5.90000000000000,5.80000000000000,5.70000000000000,5.60000000000000,5.50000000000000,5.40000000000000,5.30000000000000,5.20000000000000,5.10000000000000,5.10000000000000,5.20000000000000,5.40000000000000,5.70000000000000,5.90000000000000,6.10000000000000,6.10000000000000,6.10000000000000,6.20000000000000,6.40000000000000,6.70000000000000,7.10000000000000,7.50000000000000,8,8.40000000000000,8.70000000000000,8.90000000000000,9,9.10000000000000,9.20000000000000,9.20000000000000,9.30000000000000,9.30000000000000,9.30000000000000,9.30000000000000,9.20000000000000,9.20000000000000,9.10000000000000,9,9,8.90000000000000,8.90000000000000,8.80000000000000,8.80000000000000,8.90000000000000,8.90000000000000,9.20000000000000,9.20000000000000,9.40000000000000,9.90000000000000,10.4000000000000,11.1000000000000,11.8000000000000,12.6000000000000,13.3000000000000,13.9000000000000,14.3000000000000,14.4000000000000,14.4000000000000,14.3000000000000,14.2000000000000,14.1000000000000,14.2000000000000,14.3000000000000,14.4000000000000,14.5000000000000,14.7000000000000,14.7000000000000,14.7000000000000,14.6000000000000,14.4000000000000,14.3000000000000,14,13.8000000000000,13.5000000000000,13.4000000000000,13.3000000000000,13.2000000000000,13,12.8000000000000,12.6000000000000,12.3000000000000,12.1000000000000,11.9000000000000,11.8000000000000,11.7000000000000,11.5000000000000,11.4000000000000,11.2000000000000,11,10.8000000000000,10.6000000000000,10.4000000000000,10.2000000000000,10.1000000000000,10.1000000000000,10.2000000000000,10.3000000000000,10.4000000000000,10.6000000000000,10.7000000000000,10.8000000000000,10.9000000000000,11,11.2000000000000,11.3000000000000,11.3000000000000,11.3000000000000,11.2000000000000,11,10.9000000000000,10.7000000000000,10.5000000000000,10.3000000000000,10.1000000000000,9.90000000000000,9.90000000000000,9.80000000000000,9.80000000000000,9.70000000000000,9.70000000000000,9.50000000000000,9.50000000000000,9.40000000000000,9.20000000000000,9.10000000000000,9,8.90000000000000,9.40000000000000,8.80000000000000,8.70000000000000,8.80000000000000,8.90000000000000,9.20000000000000,9.50000000000000,9.90000000000000,10.4000000000000,10.8000000000000,11.3000000000000,11.9000000000000,12.4000000000000,12.8000000000000,13.1000000000000,13.3000000000000,13.4000000000000,13.3000000000000,13.2000000000000,13,12.8000000000000,12.5000000000000,12.2000000000000,11.9000000000000,11.6000000000000,11.4000000000000,11.2000000000000,11.1000000000000,11.1000000000000,11,11,10.9000000000000,11,10.8000000000000,10.7000000000000,10.5000000000000,10.5000000000000,10.5000000000000,10.6000000000000,10.8000000000000,11.2000000000000,11.7000000000000,12.3000000000000,13.2000000000000,14.1000000000000,15,15.9000000000000,16.7000000000000,17.3000000000000,17.7000000000000,17.9000000000000,18,18,18,18,18,17.9000000000000,17.7000000000000,17.5000000000000,17.2000000000000,16.9000000000000,16.7000000000000,16.4000000000000,16.2000000000000,16,15.9000000000000,15.8000000000000,15.7000000000000,15.5000000000000,15,15.4000000000000,15.2000000000000,15.2000000000000,15.2000000000000,15.5000000000000,15.9000000000000,16.4000000000000,16.9000000000000,17.3000000000000,17.7000000000000,17.8000000000000,17.9000000000000,17.9000000000000,17.9000000000000,17.8000000000000,17.7000000000000,17.5000000000000,17.4000000000000,17.2000000000000};

    // all trainable parameters
    double b1[5] = {0.97199707868033080604,0.84970240709995947803,-0.15937797632755229538,1.0266898895729188457,-0.97594420542873416835}; 
    double w1[5][16] = {{1.164320336648172, 0.4964198713011772, 0.21682103241796155, -0.360707025793758, -0.6323262738185662, 0.2598140448387322, -0.47920718030238213, 0.44474051528543357, 0.6552414151529523, -0.3281434973493009, 0.4810675947901371, 0.6767468371795047, -0.1697829586950127, -0.038525853384178965, -0.527865392373764, -1.2116690674062451},
                        {-1.9095656732460067, 0.37134714857414747, 0.24004771153025303, 0.42795817648364454, -0.04169265646936144, -0.3593529623791128, -0.0038927266161121656, 0.009408946729746504, 0.13529698349133912, -0.12219476216648933, 0.13089459811230728, -0.020724958762818227, -0.1399168442843877, 0.20522233315021052, -0.02902246301057549, -0.04843698306090549}, 
                        {0.7183129403310718, 0.1906959769956139, 0.5510310833286153, 0.0008397949799422105, 0.10073257589361641, 0.5630396372114319, 0.8782318787187924, 0.051261392799244174, 0.46277143086594685, 0.03742650802531531, 0.9128260078521429, 0.7955031371142413, -0.13272285670007278, 0.34722959344625276, 0.19997807638948636, 0.10016027977701981}, 
                        {0.004977701082304024, 0.2414072499033453, 1.1218280414738708, 1.038313186000894, 0.24691363116277817, 0.784481726925018, 0.31155249996467826, 0.11014070302532852, 0.40507271660418015, -0.04303651116389494, -0.4192649581506801, -0.744779373279568, -0.49600340174755286, -0.5845542691397548, 0.04787290700864128, -0.20375916589342424}, 
                        {-0.820740816488855, -0.5797850080134885, 0.5178850112129862, 0.22354195970183288, -0.0831778595831273, 0.18106184665880024, -0.013746499712740348, 0.2163648768407601, -0.3737290500275838, -0.02953499318179627, 0.3579458758353304, 0.4262969940123263, -0.15023777170215372, -0.3573897815305027, -0.310501752420533, -0.13220363586361936}};
    
    double b2 = -0.3221671562204702;
    double w2[5] = {0.2627891654358972, -0.7462411546526152, 0.01595650142157494, 0.0931107697322702, -0.7797551869101471};

    double xoffset = 2.2;
    double gain    = 0.1;
    double ymin    = -1;

    double xd1[17] = {16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 16, 0};

    double y[293] = {0};

    for(int ts = 0; ts < 16; ts++){
        xd1[ts] = (xd1[ts] - xoffset) * gain + ymin;
    }

    double tapdelay1[16] = {0};

    for(int ts = 0; ts < 293; ts++){

        int xdts = (ts + 16) % 17;

        xd1[xdts] = (x[ts] - xoffset) * gain + ymin;

        for (int i = 0; i < 16; i++){
            int idx = (((xdts - i - 1) % 17) + 17) % 17;
            tapdelay1[i] = xd1[idx];
        }

        double a1[5] = {0};
        for (int i = 0; i < 5; i++)
        {
            double sum = 0.0;
            for(int j = 0; j < 16; j++){
                sum += w1[i][j] * tapdelay1[j];
            }
            a1[i] = tanh(sum + b1[i]);
        }

        double a2 = 0;
        for (int i = 0; i < 5; i++)
        {
            a2 += w2[i] * a1[i];
        }

        a2 += b2;

        y[ts] = (a2 - ymin) / gain + xoffset;

    }

    for (int i = 0; i < 293; i++)
    {
        printf("%f\n", y[i]);
    }
    

    return 0;
}